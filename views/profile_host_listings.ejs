<!DOCTYPE html>
<html>
  <head>
     <% include partials/head %>
  </head>
  <body>
    
    <div class="container-fluid">
    	<div class="row">
    		<div class="col-12">
                
                <% include partials/navigation %>
                <h2><%= page %></h2><br>

                <% if (listingArray.length > 0) { %>

                <% listingArray.forEach( c => { %>
                    <div>
                        <h2>Property <a href="http://localhost:3000/listing/<%= c.id %>"><%= c.name %></a><h2>
                        <h2>Rating: <%= c.rating %></h2><br>

                        <% if (c.picture_url) { %>
                            <img width="960" height="540" src="<%= c.picture_url %>" />
                        <% } else { %>
                            <img width="960" height="540"/>
                        <% } %>
                        
                        <div>
                          <input id="delete_listing_<%= c.id %>" name="<%= c.id %>" type="submit" value="Delete"></input>
                          <h3>Price: $<%= c.price %></h3>
                        
                        <table>
                          <tr>
                            <td style="padding-right:16px;">
                              <h3>Room Type: <%= c.room_type %></h3>
                            </td>
                            <td style="padding-right:16px;">
                              <h3>Neighborhood: <%= c.neighbourhood_cleansed %></h3>
                            </td>
                          </tr>
                          <tr>
                            <td style="padding-right:16px;">
                              <h3>Bathrooms: <%= c.bathrooms %></h3>
                            </td>
                          
                            <td style="padding-right:16px;">
                              <h3>Bedrooms: <%= c.bedrooms %></h3>   
                            </td> 
                        
                            <td style="padding-right:16px;">
                              <h3>Beds: <%= c.beds %></h3> 
                            </td>      
                          </tr>
                        </table>
                         
                          <h3>Description:</h3><p><%= c.description %> </p>
                        </div>
                        
                        <script>

                          deleteButtons = document.getElementsByTagName("input");
                          listing_ids = []
                          for (var i=0; i<deleteButtons.length; i++) {
                            var listing_id = deleteButtons[i].name;

                            deleteButtons[i].addEventListener('click', (event) => {
                                console.log(event);
                                fetch('http://localhost:3000/listing/'+event.srcElement.name, {
                                  method: 'DELETE',
                                  headers: {
                                    'Content-Type': 'application/json'
                                  }
                                }).then(res => res.json())
                                  .then(data => {
                                    window.location.reload();
                                  });
                               });
                          }

                        </script>

                        
                        
                    </div>
                    <br><br>
                <% }) %>
                <% } else { %>

                  <h3>No listings to display.</h3>

                <% } %>

            </div>
    	</div>
	</div>
  </body>
</html>